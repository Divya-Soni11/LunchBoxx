import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:firebase_core/firebase_core.dart';
import 'package:google_fonts/google_fonts.dart';

import 'config/firebase_options.dart';
import 'config/routes.dart';
import 'config/theme.dart';
import 'repositories/auth_repository.dart';
import 'repositories/tiffin_repository.dart';
import 'repositories/chat_repository.dart';
import 'repositories/payment_repository.dart';
import 'blocs/auth/auth_bloc.dart';
import 'blocs/tiffin/tiffin_bloc.dart';
import 'blocs/booking/booking_bloc.dart';
import 'screens/splash_screen.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  await Firebase.initializeApp(options: DefaultFirebaseOptions.currentPlatform);
  
  runApp(const LunchBoxxApp());
}

class LunchBoxxApp extends StatelessWidget {
  const LunchBoxxApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MultiRepositoryProvider(
      providers: [
        RepositoryProvider(create: (context) => AuthRepository()),
        RepositoryProvider(create: (context) => TiffinRepository()),
        RepositoryProvider(create: (context) => ChatRepository()),
        RepositoryProvider(create: (context) => PaymentRepository()),
      ],
      child: MultiBlocProvider(
        providers: [
          BlocProvider(
            create: (context) => AuthBloc(
              authRepository: context.read<AuthRepository>(),
            )..add(AuthCheckRequested()),
          ),
          BlocProvider(
            create: (context) => TiffinBloc(
              tiffinRepository: context.read<TiffinRepository>(),
            ),
          ),
          BlocProvider(
            create: (context) => BookingBloc(
              tiffinRepository: context.read<TiffinRepository>(),
            ),
          ),
        ],
        child: MaterialApp(
          title: 'LunchBoxx',
          debugShowCheckedModeBanner: false,
          theme: AppTheme.lightTheme,
          onGenerateRoute: AppRoutes.generateRoute,
          home: const SplashScreen(),
        ),
      ),
    );
  }
}
